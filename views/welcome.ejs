<%- include('./partials/home_nav.ejs')%>

<% if(paginatedPosts.length > 0) { %>
  <!-- Display paginated posts -->
  <% paginatedPosts.forEach(post => { %>
    <div class="container mt-5 mb-5" style="max-width: 1200px;">
      <div class="row d-flex align-items-center justify-content-center">
        <div class="col-md-6">
          <div class="card">
            <div class="d-flex justify-content-between p-2 px-3">
              <div class="d-flex flex-row align-items-center"> 
                <img src="https://bootdey.com/img/Content/avatar/avatar7.png" width="50" class="rounded-circle">
                <div class="d-flex flex-column ml-2"> 
                  <span class="font-weight-bold"> <%= post.user.name %></span> 
                  <small class="text-primary">Student</small> 
                </div>
              </div>
              <div class="d-flex flex-row mt-1 ellipsis"> 
                <small class="mr-2">
                  <span class="post-time" data-timestamp="<%= post.date %>">
                    <%= post.date.toDateString() %>
                  </span>
                </small>
              </div>
            </div>
            <div class="p-2">
              <% if (post.desc.length <= 150) { %>
                <p class="text-justify"><%= post.desc %></p>
                <button class="see-more-button"><a href="/eachPost/<%= post._id %>">See Details</a></button>
              <% } else { %>
                <p class="text-justify" data-desc="<%= post.desc %>"><%= post.desc.slice(0, 150) %></p>
                <button class="see-more-button"><a href="/eachPost/<%= post._id %>">See Details</a></button>
              <% } %>
              <hr>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% }); %>

<!-- Pagination Links -->
<div class="pagination mt-3 d-flex justify-content-center">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>" class="page-link">Previous</a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <a href="?page=<%= i %>" class="page-link <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>" class="page-link">Next</a>
  <% } %>
</div>

<% } else { %>
  <p class="post-content">There is nothing to show</p>
<% } %>


<%- include('./partials/footer.ejs')%>

<script>
  // Your existing JavaScript code for updating posting times
  // ...

  // Function to handle See More/See Less functionality
  document.querySelectorAll('.see-more-button').forEach(function (button) {
    button.addEventListener('click', function () {
      const paragraphElement = this.previousElementSibling;
      if (paragraphElement) {
        const fullDescription = paragraphElement.getAttribute('data-desc');
        const currentState = paragraphElement.getAttribute('data-state');
        if (currentState === 'collapsed') {
          paragraphElement.textContent = fullDescription;
          paragraphElement.setAttribute('data-state', 'expanded');
          button.textContent = 'Show Less';
        } else {
          paragraphElement.textContent = fullDescription.slice(0, 150);
          paragraphElement.setAttribute('data-state', 'collapsed');
          button.textContent = '...See More';
        }
      } else {
        console.error('Paragraph element not found');
      }
    });
  });
</script>


